---
layout: post
title:  "0x01 - c#自问自答 - 委托"
date:  2017-3-22 18:37:16+0800
categories: csharp
author: chengzi
---

* 目录
{:toc}

## 1. yield 是什么？



## 2. P/Invoke是什么，怎么用？

**Platform Invocation Services (PInvoke)** allows managed code to call unmanaged functions that are implemented in a DLL.

平台调用服务允许托管代码去调用dll中实现的非托管函数。

1. [How to: Implement Callback Functions](https://msdn.microsoft.com/en-us/library/843s5s5x(v=vs.110).aspx)
2. [EnumWindows function](https://msdn.microsoft.com/en-us/library/windows/desktop/ms633497(v=vs.85).aspx)
3. [EnumWindowsProc callback function](https://msdn.microsoft.com/en-us/library/windows/desktop/ms633498(v=vs.85).aspx)

![回调通常与原始调用者处于相同的抽象层](/images/callback.png)

**回调通常与原始调用者处于相同的抽象层**

```csharp
public delegate bool CallBack(int hwnd, int lParam);

public class EnumReportApp
{
    [DllImport("user32")]
    public static extern int EnumWindows(CallBack x, int y);

    public static void Main()
    {
        CallBack myCallBack = new CallBack(EnumReportApp.Report);
        EnumWindows(myCallBack, 1024);
        // 1024这个参数经EnumWindows这个函数输入，
        // 再经EnumWindows传送到callback中，
        // callBack就可以处理
        // callBack返回值，传送到EnumWindows中，false结束枚举窗口dll函数
        // 代码执行桟==>重新回到Main函数中
        Console.Read();

        //执行流程：
        // Main函数 --> Dll函数 --> CallBack函数 -->Main函数
    }

    public static bool Report(int hwnd, int lParam)
    {
        Console.Write("Window handle is ");
        Console.WriteLine(hwnd+ "\t\t\t\t\t\t" + lParam);
        if (hwnd > 100000)
            return false;
        return true;
    }
}
```
