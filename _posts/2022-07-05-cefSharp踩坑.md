> èƒŒæ™¯ï¼š ä¸€ä¸ªè€çš„å®¢æˆ·ç«¯é¡¹ç›®ï¼Œæ²¡äººç»´æŠ¤äº†ï¼Œæ”¹ä¸º H5 æ–¹æ¡ˆå®ç°

éƒ¨åˆ†ä¸“ç”¨ç¡¬ä»¶é©±åŠ¨é™åˆ¶ï¼Œ windows ç³»ç»Ÿé”å®šåœ¨ windows7, .net ç‰ˆæœ¬é”å®šåœ¨ .net4, åŸå®¢æˆ·ç«¯é‡‡ç”¨çš„ wpf æ–¹æ¡ˆï¼Œæœç´¢åå‘ç°cef ç‰ˆæœ¬æœ€é«˜ `Install-Package CefSharp.Wpf -Version 49.0.1` 49 ç‰ˆæœ¬ï¼ˆ2016/6/1ï¼‰ã€‚


æœ‰å‡ ä¸ªé—®é¢˜è¦è§£å†³

## 1. å»æ‰è·¨åŸŸé™åˆ¶
```cs
// 1.å…¨å±€è®¾ç½®ï¼Œå¯¹æ•´ä¸ªè¿›ç¨‹ç”Ÿæ•ˆ
CefSettings setting = new CefSharp.CefSettings();
setting.CefCommandLineArgs.Add("disable-web-security", "1");
Cef.Initialize(setting);
// 2. ä¹Ÿå¯ä»¥é’ˆå¯¹å•ä¸ªåŸŸè®¾ç½®
//Cef.AddCrossOriginWhitelistEntry();
```

## 2. è®¾ç½® proxy
```cs
// æ–¹æ³•1. å…¨å±€è®¾ç½®ï¼Œè®¾ç½®åä¸å¯æ›´æ”¹ï¼Œéœ€è¦æ›´æ”¹åªèƒ½é‡å¯ç¨‹åº
CefSettings setting = new CefSharp.CefSettings();
setting.CefCommandLineArgs.Add("proxy-server", "http://test.com:9999");
setting.CefCommandLineArgs.Add("proxy-bypass-list", "127.*,localhost");
Cef.Initialize(setting);

// æ–¹æ³•2. ä½†æ˜¯ç¨‹åºéœ€è¦ä¿®æ”¹proxyï¼Œå¸Œæœ›ä¿®æ”¹åç«‹å³æˆæ•ˆï¼›ä¿®æ”¹åé‡å¯ç¨‹åºä½“éªŒæœ‰ç‚¹å·®
ChromiumWebBrowser wb = new ChromiumWebBrowser();
wb.RequestContext = new RequestContext();
wb.IsBrowserInitializedChanged += (s,e) =>{
    //var wb = sender as ChromiumWebBrowser;
    if (!wb.IsBrowserInitialized)
        return;

    // NOTE: é‡ç‚¹åœ¨è¿™ä¸€è¡Œã€‚ 
    Cef.UIThreadTaskFactory.StartNew(() =>
    {
        var context = wb.RequestContext;
        // debug, æŸ¥çœ‹å½“å‰é…ç½®
        //var settings = context.GetAllPreferences(true);
        // æŸ¥çœ‹æ˜¯å¦å¯ä»¥è®¾ç½® proxy
        var canSetProxy = context.CanSetPreference("proxy");
        // æ–¹å¼ 1 è®¾ç½®å…¨å±€ proxy åï¼Œè¿™é‡Œä¸èƒ½å†è®¾ç½®ï¼›è®¾ç½®ä¸ä¼šç”Ÿæ•ˆ
        if(canSetProxy){
            var v = new Dictionary<string, object>
            {
                ["mode"] = "fixed_servers",
                ["server"] = "http://test.com:9999",
                ["bypass_list"] = "127.*;localhost", // 127.*,localhost #æµ‹è¯•é€—å·åˆ†å‰²ä¹Ÿæ˜¯å¯ä»¥çš„
            };
            string err;
            var result = context.SetPreference("proxy", v, out err);
        }
    });
};
```

éº»çƒ¦å°±åœ¨è¿™ä¸€è¡Œ. `Cef.UIThreadTaskFactory.StartNew`

æŒ‰å®˜ç½‘çš„è¯´æ³•ï¼š
1. winform
https://cefsharp.github.io/api/63.0.0/html/E_CefSharp_WinForms_ChromiumWebBrowser_IsBrowserInitializedChanged.htm

``` js
Occurs when [is browser initialized changed]. 

It's important to note this event is fired on a CEF UI thread, which by default is not the same as your application UI thread. It is unwise to block on this thread for any length of time as your browser will become unresponsive and/or hang.. To access UI elements you'll need to Invoke/Dispatch onto the UI Thread.

Namespace: CefSharp.WinForms
Assembly: CefSharp.WinForms (in CefSharp.WinForms.dll) Version: 63.0.0.0 (63.0.0.0)
```
2. wpf
https://cefsharp.github.io/api/63.0.0/html/E_CefSharp_Wpf_ChromiumWebBrowser_IsBrowserInitializedChanged.htm

`Event handler that will get called when the browser has finished initializing`

æŒ‰è¿™ä¸ªæ–‡æ¡£çš„è¯´æ³•ï¼Œ å¾ˆå®¹æ˜“è®¤ä¸ºæ³¨å†Œè¿™ä¸ªäº‹ä»¶ï¼Œ ç›´æ¥å†™å°±å¥½äº†ï¼Œ å®é™…æ˜¯ä¸è¡Œï¼Œä½ éœ€è¦ `Cef.UIThreadTaskFactory.StartNew` å§”æ‰˜ brower UI thread æ‰§è¡Œæ‰å¯ä»¥ã€‚

## å¯¹æ¯”æ’é”™

1. .net4 wpf é¡¹ç›®, `Install-Package CefSharp.Wpf -Version 49.0.1`,
`var canSetProxy = context.CanSetPreference("proxy");` è¿”å› falseï¼Œ ä¸æŠ¥é”™ï¼Œè®¾ç½®åä¸ç”Ÿæ•ˆã€‚

2. .net4.5 wpf é¡¹ç›®ï¼Œ `Install-Package CefSharp.Wpf -Version 103.0.80`æµ‹è¯•ï¼Œ
`var canSetProxy = context.CanSetPreference("proxy");` ç›´æ¥å¼‚å¸¸ã€‚

ç›´åˆ°è¿™æ—¶ï¼Œæ‰å‘ç°æ˜¯æ‰§è¡Œçº¿ç¨‹ä¸å¯¹ğŸ˜…


## å‚è€ƒ
1. é«˜ç‰ˆæœ¬è®¾ç½® proxyï¼Œæœ‰æ–¹ä¾¿çš„ helper æ–¹æ³•. https://github.com/cefsharp/CefSharp/wiki/General-Usage#proxy-resolution

2. cefsharp æ·»åŠ è¿™ä¸ªåŠŸèƒ½çš„å¼€å‘æ—¥å¿—ï¼š https://github.com/cefsharp/CefSharp/issues/3235

3. Setting proxy bypass list in preferences 

    > https://magpcss.org/ceforum/viewtopic.php?f=6&t=14097
    > https://source.chromium.org/chromium/chromium/src/+/main:net/proxy_resolution/proxy_config.cc;l=279?q=proxy_config.cc&ss=chromium

4.  https://github.com/cefsharp/CefSharp/blob/cefsharp/57/CefSharp.Core/RequestContext.h#L305
    > Set the value associated with preference name. If value is null the preference will be restored to its default value.
    > SetPreference()

5. chrome.proxy  https://developer.chrome.com/docs/extensions/reference/proxy/

6. CefSharp å¼€å‘è§¦å±ç»ˆç«¯é‡åˆ°çš„é—®é¢˜è®°å½• https://blog.51cto.com/u_15127592/2803343